# Скрипты Wiki.js MCP Server

Эта директория содержит скрипты для управления и настройки Wiki.js MCP сервера.

## Настройка

### setup.sh

**Назначение:** Первоначальная настройка проекта  
**Использование:** `./scripts/setup.sh`

Выполняет:

- Проверку версии Node.js (рекомендуется ≥18)
- Установку зависимостей (`npm install`)
- Создание файла `.env` на основе `example.env`
- Сборку TypeScript кода (`npm run build`)

### setup_cursor_mcp.sh

**Назначение:** Настройка интеграции с Cursor IDE  
**Использование:** `./scripts/setup_cursor_mcp.sh`

Выполняет:

- Чтение конфигурации из файла `.env`
- Создание файла `.cursor/mcp.json` с правильными настройками
- Резервное копирование существующих конфигураций

## Запуск серверов

### start_http.sh

**Назначение:** Запуск основного HTTP MCP сервера (рекомендуемый)  
**Использование:** `./scripts/start_http.sh`  
**Порт по умолчанию:** 3200

Это основная рабочая версия сервера с поддержкой:

- JSON-RPC 2.0 протокола для Cursor
- Прямых вызовов инструментов через HTTP
- Server-Sent Events (SSE) для событий
- Полной совместимости с Cursor MCP

### start_typescript.sh

**Назначение:** Запуск TypeScript версии сервера  
**Использование:** `./scripts/start_typescript.sh`  
**Порт по умолчанию:** 8000

Запускает скомпилированную версию из директории `dist/`. Автоматически выполняет сборку если файлы не найдены.

## Тестирование

### test.sh

**Назначение:** Запуск тестов MCP сервера  
**Использование:** `./scripts/test.sh`

Выполняет:

- Тест HTTP сервера (`scripts/test_mcp.js`)
- Тест STDIN сервера (`scripts/test_mcp_stdin.js`)

### test_mcp.js

**Назначение:** Тестирование HTTP MCP сервера  
**Использование:** `node scripts/test_mcp.js`

Запускает HTTP сервер и проверяет его работоспособность.

### test_mcp_stdin.js

**Назначение:** Тестирование STDIN MCP сервера  
**Использование:** `node scripts/test_mcp_stdin.js`

Запускает STDIN сервер и тестирует его функциональность.

## Переменные окружения

Все скрипты используют единую конфигурацию из файла `.env` в корне проекта:

```bash
# Порт для сервера MCP
PORT=3200

# Базовый URL для Wiki.js (без /graphql)
WIKIJS_BASE_URL=http://localhost:3000

# API-токен Wiki.js
WIKIJS_TOKEN=your_wikijs_api_token_here
```

## Особенности использования

1. **Единое место конфигурации:** Все переменные окружения задаются только в файле `.env`
2. **Автоматические значения по умолчанию:** Если переменные не заданы, используются безопасные умолчания
3. **Проверка зависимостей:** Скрипты проверяют наличие обязательных переменных перед запуском
4. **Логирование:** Все серверы сохраняют логи в соответствующие файлы
5. **PID файлы:** Процессы сохраняют свои PID для управления

## Рекомендуемый порядок использования

1. Запустите настройку: `./scripts/setup.sh`
2. Отредактируйте файл `.env` с вашими настройками Wiki.js
3. Запустите HTTP сервер: `./scripts/start_http.sh`
4. Настройте Cursor: `./scripts/setup_cursor_mcp.sh`
5. Перезапустите Cursor

## Устранение неполадок

- **Проверка здоровья сервера:** `curl http://localhost:3200/health`
- **Просмотр логов:** `tail -f fixed_server.log` или `tail -f server.log`
- **Остановка серверов:** `pkill -f "node fixed_mcp_http_server.js"`

## Совместимость

- **Node.js:** ≥18.0.0
- **Cursor IDE:** Поддержка MCP
- **Wiki.js:** Версии с GraphQL API
- **ОС:** macOS, Linux, Windows (с WSL)
